<?php
    // Prevent direct access to this class.
    if (isset($GLOBALS['OHCRUD']) == false) { die(); }

    // Check if user is logged in and has admin permissions
    if(isset($_SESSION['User']) == false || $_SESSION['User']->PERMISSIONS !== 1) {
        $this->redirect('/?action=login&redirect=/?action=server');
        exit();
    }

    // Function to get cleaned phpinfo output
    function get_clean_phpinfo() {
        ob_start();
        phpinfo(INFO_GENERAL | INFO_CONFIGURATION | INFO_MODULES);
        $html = ob_get_clean();

        // Remove the entire <head> section (and its internal CSS)
        $html = preg_replace('/<head>.*?<\/head>/s', '', $html);

        // Remove all <img> tags (logos/images)
        $html = preg_replace('/<img[^>]+>/i', '', $html);
        $html = preg_replace('/<svg[^>]+>/i', '', $html);

        // Remove Credits and License sections
        // These are typically identified by specific headers in phpinfo
        $html = preg_replace('/<h1>PHP Credits<\/h1>.*?<hr \/>/s', '', $html);
        $html = preg_replace('/<h1>Configuration<\/h1>.*?<hr \/>/s', '', $html); // Optional: keep if you want config
        $html = preg_replace('/<h1>PHP License<\/h1>.*?<\/table>/s', '', $html);

        // Remove any remaining <a> links that point to the PHP logo or credits
        $html = preg_replace('/<a href="[^"]*php\.net[^"]*">.*?<\/a>/i', '', $html);

        // Clean up the body tags and common phpinfo wrappers
        $html = preg_replace('/<\/?(html|body)>/i', '', $html);

        // Strip out the inline "center" styling
        $html = str_replace('class="center"', '', $html);

        return "<div class='clean-php-info'>" . trim($html) . "</div>";
    }
?>

<div class="card data-table data-table-init">
    <div class="card-header">
        <div class="data-table-title">Server Details</div>
        <div class="data-table-actions">
        </div>
    </div>

    <div class="card-content card-content-padding">
        <?php $this->debug($_COOKIE, '$_COOKIE (HTTP Cookies)', false); ?>
        <br/>
        <?php $this->debug($_SESSION, '$_SESSION (Session variables)', false); ?>
        <br/>
        <?php $this->debug(getallheaders(), 'getallheaders (Fetch all HTTP request headers)', false); ?>
        <br/>
        <?php $this->debug($_SERVER, '$_SERVER (Server and execution environment information)', false); ?>
        <br/>
        <?php print(get_clean_phpinfo()); ?>
    </div>

</div>
